# Lotsful AI Engine - 段階的情報蓄積型AI分析システム 要件定義書

## プロジェクト概要

企業の業務切り出しを支援し、副業/兼業人材との最適なマッチングを実現するAI分析システム。
**段階的情報蓄積アプローチ**により、各ステップでAI分析を行い、構造化テンプレートに情報を蓄積。
最終的に包括的な5タブ提案書を生成する営業支援ツール。

## システム構成

- **フロントエンド**: Next.js 15.3.3 + React 19 + TypeScript + Tailwind CSS
- **バックエンド**: Next.js API Routes (サーバーサイド処理)
- **AI**: Google Gemini 2.5 Flash Preview-05-20
- **データ**: セッションベース（データベース不要）
- **デプロイ**: Vercel + GitHub連携

## 機能要件

### 1. 新アーキテクチャ：段階的情報蓄積システム

#### コアコンセプト
**従来**: 一発型AI分析（ステップ3で全情報を一括処理）
**新**: 段階的蓄積型（各ステップでAI分析 → 構造化テンプレートに蓄積 → 最終統合分析）

#### 情報蓄積テンプレート構造
```
lotsful プロジェクト×人材マッチングシート

🏢 会社情報
企業名、業界、設立年、上場状況、従業員数、年商、所在地、事業内容、主要顧客層

🔍 事前リサーチ情報
企業情報メモ（ディープリサーチ結果）、最近の動き、組織特徴、仮説と洞察

📊 現状分析
事業フェーズ、課題カテゴリー、これまでの取り組み、チーム構成、不足スキル、外部人材経験

🎯 プロジェクト設計
解決したい課題、プロジェクトゴール、スコープ、フェーズ分け、稼働イメージ、予算

👤 人材イメージ
役割定義、必要スキル、人物像、カルチャーフィット

🤝 すり合わせ確認事項、💡 マッチング戦略、💭 商談メモ
```

#### 新3ステップフロー
1. **ステップ1: ディープリサーチ入力**
   - リサーチ結果テキスト入力
   - **AI分析ボタン** → 基本企業情報をテンプレートに蓄積
   - 業界自動判定・抽出

2. **ステップ2: 課題・追加情報入力**
   - 構造化入力 or フリーテキスト入力
   - **テンプレート直接編集機能**
   - **AI分析ボタン** → 課題情報をテンプレートに追加蓄積

3. **ステップ3: 業務選択・最終分析**
   - 業界自動連携済み
   - 7×4マトリックスで業務選択
   - 選択内容もテンプレートに保存
   - **最終AI分析** → テンプレート全体から5タブ提案書生成

### 2. 継続機能
- 7×4業務マトリックス（7カテゴリ × 4フェーズ）
- Gemini API統合
- AI Honesty機能（情報不足時は「情報不足により特定不可」表示）

### 3. 新機能：5タブ提案書システム

#### フェーズ1実装（優先度：高）
**Tab 1: 課題整理（自動生成）**
```
現状分析
企業名：[会社名]
業界：[業界]
従業員数：[規模]

課題マッピング
| 領域 | 現状 | 理想 | ギャップ |
|------|------|------|---------|
| [領域1] | [現状詳細] | [理想詳細] | [ギャップ分析] |
| [領域2] | [現状詳細] | [理想詳細] | [ギャップ分析] |
| [領域3] | [現状詳細] | [理想詳細] | [ギャップ分析] |

課題の深掘り
表面的な課題
[表面的に見えている問題]

本質的な課題
[真の原因・構造的な問題]

放置した場合の影響
- 短期（3ヶ月）: [具体的なリスク]
- 中期（6ヶ月）: [具体的なリスク]
- 長期（1年）: [具体的なリスク]
```

**Tab 2: プロジェクト設計（自動生成）**
```
プロジェクト概要
ミッション
[プロジェクトで実現すること]

スコープ定義
含むもの
✅ [スコープ1]
✅ [スコープ2]
✅ [スコープ3]

含まないもの
❌ [対象外1]
❌ [対象外2]

フェーズ設計
Phase 1: [フェーズ名]（[期間]）
目的: [このフェーズのゴール]

主要タスク
- [タスク1]
  詳細：[具体的な作業内容]
  期限：[日数/週数]
- [タスク2]
  詳細：[具体的な作業内容]
  期限：[日数/週数]

成果物
📄 [成果物1]
📊 [成果物2]
🔧 [成果物3]

マイルストーン: [具体的な達成基準]

Phase 2: [フェーズ名]（[期間]）
目的: [このフェーズのゴール]

主要タスク
- [タスク1]
  詳細：[具体的な作業内容]
  期限：[日数/週数]
- [タスク2]
  詳細：[具体的な作業内容]
  期限：[日数/週数]

成果物
📈 [成果物1]
🚀 [成果物2]

マイルストーン: [具体的な達成基準]
```

#### フェーズ2実装（優先度：中）
**Tab 3: 人材提案（手動生成ボタン）**
- 人材要件定義
  - 求める人材像
  - 必要スキルセット
  - 経験レベル
- 人材タイプ提案
  - コンサルタント系
  - 事業会社経験者
  - スタートアップ経験者
  - 専門スキル保有者
- 稼働条件
  - 想定工数（月10-80時間、デフォルト30時間）
  - リモートワーク前提
  - コミュニケーション頻度

**Tab 4: 期待成果（手動生成ボタン）**
- 定量的成果
  - ROI計算
  - コスト削減効果
  - 効率向上指標
- 定性的成果
  - 組織能力向上
  - プロセス改善
  - 競争力強化
- 時系列効果
  - 短期成果（1-3ヶ月）
  - 中期成果（3-6ヶ月）
  - 長期成果（6ヶ月以上）

**Tab 5: 実施要項（手動生成ボタン）**
- 契約形態
  - 準委任契約
  - 成果物ベース契約
  - 時間ベース契約
- 費用構造
  - 時間単価設定
  - 成果物単価
  - 支払い条件
- 実施体制
  - プロジェクト体制図
  - 役割分担
  - 報告ライン

## 技術要件

### データ構造設計

#### 段階的蓄積テンプレート構造
```javascript
{
  // 会社情報
  companyProfile: {
    name: string,
    industry: string[],
    establishedYear: number,
    isPublic: boolean,
    marketListing: string,
    employeeCount: string,
    revenue: string,
    headquarters: string,
    offices: string[],
    businessDescription: string,
    mainCustomers: string
  },
  
  // 事前リサーチ情報
  researchData: {
    deepResearchMemo: string,
    recentNews: string,
    organizationCulture: string,
    hypothesisInsights: string,
    meetingCheckpoints: string[]
  },
  
  // 現状分析
  currentAnalysis: {
    businessPhase: string,
    challengeCategories: string[],
    previousEfforts: string,
    failureReasons: string,
    teamComposition: object[],
    missingSkills: string[],
    externalTalentExperience: string,
    freelanceReadiness: string,
    competitorAnalysis: string,
    decisionProcess: string
  },
  
  // プロジェクト設計
  projectDesign: {
    challengeSummary: string,
    urgencyReason: string,
    risksIfIgnored: string,
    idealState3Months: string,
    successMetrics: object,
    deliverables: string[],
    scope: { included: string[], excluded: string[] },
    phases: object[],
    workingHours: string,
    budget: object
  },
  
  // 人材イメージ
  talentRequirements: {
    expectedRole: string[],
    engagementType: string[],
    requiredSkills: string[],
    preferredSkills: string[],
    industryExperience: object,
    personalityType: string[],
    mindset: string[],
    cultureFit: string
  },
  
  // メタデータ
  metadata: {
    step1Completed: boolean,
    step2Completed: boolean,
    step3Completed: boolean,
    selectedBusinessItems: object[],
    analysisHistory: object[]
  }
}
```

### AI分析エンジン拡張

#### ステップ1: 企業リサーチ分析
```
入力: リサーチテキスト
出力: 企業基本情報 → テンプレート蓄積
分析内容: 企業名、業界、規模、事業内容、特徴抽出
```

#### ステップ2: 課題・追加情報分析
```
入力: 課題情報 + 既存テンプレート
出力: 課題構造化データ → テンプレート追加蓄積
分析内容: 課題分類、優先度、解決アプローチ
```

#### ステップ3: 最終統合分析
```
入力: 完全テンプレート + 選択業務項目
出力: 5タブ提案書
分析内容: 包括的プロジェクト提案生成
```

#### AI Honesty強化プロンプト
```
【重要指示】
- テンプレートに情報がない項目は「情報不足により特定不可」
- 推測や創作は禁止
- 段階的な情報収集の必要性を明示
- 営業現場での実用性を重視
```

### UI/UX設計

#### タブナビゲーション
- 5タブの横スクロール対応
- アクティブタブの視覚的強調
- 生成状態の表示（自動/手動/未生成）

#### 生成ボタン配置
- Tab3-5各タブ内に「AI分析で生成」ボタン
- 生成中のローディング表示
- 生成エラー時の再試行機能

### APIエンドポイント設計

#### 新規API（段階的分析対応）
- `/api/analyze-step1`: 企業リサーチ分析 → テンプレート基本情報蓄積
- `/api/analyze-step2`: 課題・追加情報分析 → テンプレート追加蓄積
- `/api/analyze-step3`: 最終統合分析 → 5タブ提案書生成

#### 既存API拡張
- `/api/analyze`: 既存の一括分析（後方互換）

#### 新規API（手動生成）
- `/api/generate-talent`: Tab3人材提案生成
- `/api/generate-outcome`: Tab4期待成果生成
- `/api/generate-implementation`: Tab5実施要項生成

#### テンプレート管理API
- `/api/template/save`: テンプレート保存
- `/api/template/load`: テンプレート読み込み
- `/api/template/update`: テンプレート部分更新

## 実装計画

### フェーズ1（1-2週間）：段階的蓄積システム基盤
1. **テンプレート構造設計・実装**
   - データ構造定義とTypeScript型定義
   - セッションストレージでのテンプレート管理
   
2. **ステップ1のAI分析機能追加**
   - `/api/analyze-step1` 実装
   - 企業情報抽出・構造化プロンプト開発
   - CompanyInfoInput コンポーネント拡張
   
3. **ステップ2のテンプレート編集機能**
   - テンプレート直接編集UI
   - `/api/analyze-step2` 実装
   
4. **ステップ3の統合分析機能**
   - `/api/analyze-step3` 実装
   - 既存分析エンジンとの統合

### フェーズ2（1週間）：5タブシステム完成
1. **既存5タブ構造の段階的蓄積対応**
2. **Tab3-5手動生成ボタン実装**
3. **エラーハンドリング・UI/UX最適化**
4. **総合テスト・デバッグ**

## 制約事項

- **副業/兼業制約**: リモート中心、月10-80時間（選択可能、デフォルト30時間）、準委任契約
- **AI精度**: 100%正確性不要、営業支援ツールとして十分な品質
- **データ保持**: セッションベース、永続化不要（営業支援用途）
- **対象業界**: 40+業界対応
- **対象業務**: 7カテゴリ×4フェーズ=28分野
- **段階的構築**: 既存システムとの後方互換性維持

## 成功指標

- **段階的蓄積**: 各ステップでテンプレート情報が正確に蓄積される
- **AI分析品質**: 各段階で適切な情報抽出・構造化が行われる
- **ユーザビリティ**: 営業現場で直感的に使える操作性
- **提案品質**: 実際の商談で活用可能なレベルの提案書生成
- **システム安定性**: 段階的分析でのエラー発生時の適切なフォールバック

## 補足事項

- **AI Honesty機能**: 情報不足時の正直な回答（「情報不足により特定不可」）
- **Gemini 2.5 Flash Preview-05-20**: 継続使用
- **段階的リリース**: テンプレート基盤 → ステップ分析 → 5タブ完成
- **既存機能**: 現在の一括分析システムも並行維持

## 開発状況（2025年6月8日現在）

### 完了済み
- ✅ 5タブ提案書システム基盤（Tab1, Tab2自動生成）
- ✅ AI Honesty機能（情報不足時の正直な回答）
- ✅ Gemini 2.5 Flash Preview-05-20 統合
- ✅ 業界自動判定機能

### 実装予定
- 🔄 段階的情報蓄積システム（本要件定義に基づく）
- 🔄 ステップ1, 2でのAI分析機能
- 🔄 テンプレート直接編集機能
- 🔄 Tab3-5手動生成機能
